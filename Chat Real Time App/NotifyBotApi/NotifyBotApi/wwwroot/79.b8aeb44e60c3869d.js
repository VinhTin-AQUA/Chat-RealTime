"use strict";(self.webpackChunkNotifyBotClient=self.webpackChunkNotifyBotClient||[]).push([[79],{5079:(wt,X,_)=>{_.r(X),_.d(X,{ChatRoomModule:()=>Ct});var P=_(6814),A=_(800),q=_(8180),o=_(5879),u=_(5861);const he=[0,2e3,1e4,3e4,null];class V{constructor(t){this._retryDelays=void 0!==t?[...t,null]:he}nextRetryDelayInMilliseconds(t){return this._retryDelays[t.previousRetryCount]}}let D=(()=>{class i{}return i.Authorization="Authorization",i.Cookie="Cookie",i})();class ee{constructor(t,e,n){this.statusCode=t,this.statusText=e,this.content=n}}class U{get(t,e){return this.send({...e,method:"GET",url:t})}post(t,e){return this.send({...e,method:"POST",url:t})}delete(t,e){return this.send({...e,method:"DELETE",url:t})}getCookieString(t){return""}}class ue extends U{constructor(t,e){super(),this._innerClient=t,this._accessTokenFactory=e}send(t){var e=this;return(0,u.Z)(function*(){let n=!0;e._accessTokenFactory&&(!e._accessToken||t.url&&t.url.indexOf("/negotiate?")>0)&&(n=!1,e._accessToken=yield e._accessTokenFactory()),e._setAuthorizationHeader(t);const r=yield e._innerClient.send(t);return n&&401===r.statusCode&&e._accessTokenFactory?(e._accessToken=yield e._accessTokenFactory(),e._setAuthorizationHeader(t),yield e._innerClient.send(t)):r})()}_setAuthorizationHeader(t){t.headers||(t.headers={}),this._accessToken?t.headers[D.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&t.headers[D.Authorization]&&delete t.headers[D.Authorization]}getCookieString(t){return this._innerClient.getCookieString(t)}}class I extends Error{constructor(t,e){const n=new.target.prototype;super(`${t}: Status code '${e}'`),this.statusCode=e,this.__proto__=n}}class F extends Error{constructor(t="A timeout occurred."){const e=new.target.prototype;super(t),this.__proto__=e}}class S extends Error{constructor(t="An abort occurred."){const e=new.target.prototype;super(t),this.__proto__=e}}class de extends Error{constructor(t,e){const n=new.target.prototype;super(t),this.transport=e,this.errorType="UnsupportedTransportError",this.__proto__=n}}class ge extends Error{constructor(t,e){const n=new.target.prototype;super(t),this.transport=e,this.errorType="DisabledTransportError",this.__proto__=n}}class pe extends Error{constructor(t,e){const n=new.target.prototype;super(t),this.transport=e,this.errorType="FailedToStartTransportError",this.__proto__=n}}class fe extends Error{constructor(t){const e=new.target.prototype;super(t),this.errorType="FailedToNegotiateWithServerError",this.__proto__=e}}class _e extends Error{constructor(t,e){const n=new.target.prototype;super(t),this.innerErrors=e,this.__proto__=n}}var c=function(i){return i[i.Trace=0]="Trace",i[i.Debug=1]="Debug",i[i.Information=2]="Information",i[i.Warning=3]="Warning",i[i.Error=4]="Error",i[i.Critical=5]="Critical",i[i.None=6]="None",i}(c||{});class M{constructor(){}log(t,e){}}M.instance=new M;const me="7.0.9";class v{static isRequired(t,e){if(null==t)throw new Error(`The '${e}' argument is required.`)}static isNotEmpty(t,e){if(!t||t.match(/^\s*$/))throw new Error(`The '${e}' argument should not be empty.`)}static isIn(t,e,n){if(!(t in e))throw new Error(`Unknown ${n} value: ${t}.`)}}class b{static get isBrowser(){return"object"==typeof window&&"object"==typeof window.document}static get isWebWorker(){return"object"==typeof self&&"importScripts"in self}static get isReactNative(){return"object"==typeof window&&typeof window.document>"u"}static get isNode(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}}function R(i,t){let e="";return $(i)?(e=`Binary data of length ${i.byteLength}`,t&&(e+=`. Content: '${function ve(i){const t=new Uint8Array(i);let e="";return t.forEach(n=>{e+=`0x${n<16?"0":""}${n.toString(16)} `}),e.substr(0,e.length-1)}(i)}'`)):"string"==typeof i&&(e=`String data of length ${i.length}`,t&&(e+=`. Content: '${i}'`)),e}function $(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function te(i,t,e,n,r,s){return L.apply(this,arguments)}function L(){return(L=(0,u.Z)(function*(i,t,e,n,r,s){const a={},[l,h]=E();a[l]=h,i.log(c.Trace,`(${t} transport) sending data. ${R(r,s.logMessageContent)}.`);const d=$(r)?"arraybuffer":"text",g=yield e.post(n,{content:r,headers:{...a,...s.headers},responseType:d,timeout:s.timeout,withCredentials:s.withCredentials});i.log(c.Trace,`(${t} transport) request complete. Response status: ${g.statusCode}.`)})).apply(this,arguments)}class Ce{constructor(t,e){this._subject=t,this._observer=e}dispose(){const t=this._subject.observers.indexOf(this._observer);t>-1&&this._subject.observers.splice(t,1),0===this._subject.observers.length&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(e=>{})}}class O{constructor(t){this._minLevel=t,this.out=console}log(t,e){if(t>=this._minLevel){const n=`[${(new Date).toISOString()}] ${c[t]}: ${e}`;switch(t){case c.Critical:case c.Error:this.out.error(n);break;case c.Warning:this.out.warn(n);break;case c.Information:this.out.info(n);break;default:this.out.log(n)}}}}function E(){let i="X-SignalR-User-Agent";return b.isNode&&(i="User-Agent"),[i,we(me,ye(),b.isNode?"NodeJS":"Browser",Se())]}function we(i,t,e,n){let r="Microsoft SignalR/";const s=i.split(".");return r+=`${s[0]}.${s[1]}`,r+=` (${i}; `,r+=t&&""!==t?`${t}; `:"Unknown OS; ",r+=`${e}`,r+=n?`; ${n}`:"; Unknown Runtime Version",r+=")",r}function ye(){if(!b.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function Se(){if(b.isNode)return process.versions.node}function ne(i){return i.stack?i.stack:i.message?i.message:`${i}`}class ke extends U{constructor(t){if(super(),this._logger=t,typeof fetch>"u"){const e=require;this._jar=new(e("tough-cookie").CookieJar),this._fetchType=e("node-fetch"),this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(function Te(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}());if(typeof AbortController>"u"){const e=require;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}send(t){var e=this;return(0,u.Z)(function*(){if(t.abortSignal&&t.abortSignal.aborted)throw new S;if(!t.method)throw new Error("No method defined.");if(!t.url)throw new Error("No url defined.");const n=new e._abortControllerType;let r;t.abortSignal&&(t.abortSignal.onabort=()=>{n.abort(),r=new S});let a,s=null;t.timeout&&(s=setTimeout(()=>{n.abort(),e._logger.log(c.Warning,"Timeout from HTTP request."),r=new F},t.timeout)),""===t.content&&(t.content=void 0),t.content&&(t.headers=t.headers||{},t.headers["Content-Type"]=$(t.content)?"application/octet-stream":"text/plain;charset=UTF-8");try{a=yield e._fetchType(t.url,{body:t.content,cache:"no-cache",credentials:!0===t.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...t.headers},method:t.method,mode:"cors",redirect:"follow",signal:n.signal})}catch(d){throw r||(e._logger.log(c.Warning,`Error from HTTP request. ${d}.`),d)}finally{s&&clearTimeout(s),t.abortSignal&&(t.abortSignal.onabort=null)}if(!a.ok){const d=yield oe(a,"text");throw new I(d||a.statusText,a.status)}const h=yield oe(a,t.responseType);return new ee(a.status,a.statusText,h)})()}getCookieString(t){let e="";return b.isNode&&this._jar&&this._jar.getCookies(t,(n,r)=>e=r.join("; ")),e}}function oe(i,t){let e;switch(t){case"arraybuffer":e=i.arrayBuffer();break;case"text":default:e=i.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`)}return e}class Ie extends U{constructor(t){super(),this._logger=t}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new S):t.method?t.url?new Promise((e,n)=>{const r=new XMLHttpRequest;r.open(t.method,t.url,!0),r.withCredentials=void 0===t.withCredentials||t.withCredentials,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===t.content&&(t.content=void 0),t.content&&($(t.content)?r.setRequestHeader("Content-Type","application/octet-stream"):r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const s=t.headers;s&&Object.keys(s).forEach(a=>{r.setRequestHeader(a,s[a])}),t.responseType&&(r.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=()=>{r.abort(),n(new S)}),t.timeout&&(r.timeout=t.timeout),r.onload=()=>{t.abortSignal&&(t.abortSignal.onabort=null),r.status>=200&&r.status<300?e(new ee(r.status,r.statusText,r.response||r.responseText)):n(new I(r.response||r.responseText||r.statusText,r.status))},r.onerror=()=>{this._logger.log(c.Warning,`Error from HTTP request. ${r.status}: ${r.statusText}.`),n(new I(r.statusText,r.status))},r.ontimeout=()=>{this._logger.log(c.Warning,"Timeout from HTTP request."),n(new F)},r.send(t.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class Ee extends U{constructor(t){if(super(),typeof fetch<"u"||b.isNode)this._httpClient=new ke(t);else{if(!(typeof XMLHttpRequest<"u"))throw new Error("No usable HttpClient found.");this._httpClient=new Ie(t)}}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new S):t.method?t.url?this._httpClient.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(t){return this._httpClient.getCookieString(t)}}var C=function(i){return i[i.None=0]="None",i[i.WebSockets=1]="WebSockets",i[i.ServerSentEvents=2]="ServerSentEvents",i[i.LongPolling=4]="LongPolling",i}(C||{}),w=function(i){return i[i.Text=1]="Text",i[i.Binary=2]="Binary",i}(w||{});class Ne{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class re{constructor(t,e,n){this._httpClient=t,this._logger=e,this._pollAbort=new Ne,this._options=n,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}connect(t,e){var n=this;return(0,u.Z)(function*(){if(v.isRequired(t,"url"),v.isRequired(e,"transferFormat"),v.isIn(e,w,"transferFormat"),n._url=t,n._logger.log(c.Trace,"(LongPolling transport) Connecting."),e===w.Binary&&typeof XMLHttpRequest<"u"&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,s]=E(),a={[r]:s,...n._options.headers},l={abortSignal:n._pollAbort.signal,headers:a,timeout:1e5,withCredentials:n._options.withCredentials};e===w.Binary&&(l.responseType="arraybuffer");const h=`${t}&_=${Date.now()}`;n._logger.log(c.Trace,`(LongPolling transport) polling: ${h}.`);const d=yield n._httpClient.get(h,l);200!==d.statusCode?(n._logger.log(c.Error,`(LongPolling transport) Unexpected response code: ${d.statusCode}.`),n._closeError=new I(d.statusText||"",d.statusCode),n._running=!1):n._running=!0,n._receiving=n._poll(n._url,l)})()}_poll(t,e){var n=this;return(0,u.Z)(function*(){try{for(;n._running;)try{const r=`${t}&_=${Date.now()}`;n._logger.log(c.Trace,`(LongPolling transport) polling: ${r}.`);const s=yield n._httpClient.get(r,e);204===s.statusCode?(n._logger.log(c.Information,"(LongPolling transport) Poll terminated by server."),n._running=!1):200!==s.statusCode?(n._logger.log(c.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),n._closeError=new I(s.statusText||"",s.statusCode),n._running=!1):s.content?(n._logger.log(c.Trace,`(LongPolling transport) data received. ${R(s.content,n._options.logMessageContent)}.`),n.onreceive&&n.onreceive(s.content)):n._logger.log(c.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){n._running?r instanceof F?n._logger.log(c.Trace,"(LongPolling transport) Poll timed out, reissuing."):(n._closeError=r,n._running=!1):n._logger.log(c.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{n._logger.log(c.Trace,"(LongPolling transport) Polling complete."),n.pollAborted||n._raiseOnClose()}})()}send(t){var e=this;return(0,u.Z)(function*(){return e._running?te(e._logger,"LongPolling",e._httpClient,e._url,t,e._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){var t=this;return(0,u.Z)(function*(){t._logger.log(c.Trace,"(LongPolling transport) Stopping polling."),t._running=!1,t._pollAbort.abort();try{yield t._receiving,t._logger.log(c.Trace,`(LongPolling transport) sending DELETE request to ${t._url}.`);const e={},[n,r]=E();e[n]=r;const s={headers:{...e,...t._options.headers},timeout:t._options.timeout,withCredentials:t._options.withCredentials};yield t._httpClient.delete(t._url,s),t._logger.log(c.Trace,"(LongPolling transport) DELETE request sent.")}finally{t._logger.log(c.Trace,"(LongPolling transport) Stop finished."),t._raiseOnClose()}})()}_raiseOnClose(){if(this.onclose){let t="(LongPolling transport) Firing onclose event.";this._closeError&&(t+=" Error: "+this._closeError),this._logger.log(c.Trace,t),this.onclose(this._closeError)}}}class Pe{constructor(t,e,n,r){this._httpClient=t,this._accessToken=e,this._logger=n,this._options=r,this.onreceive=null,this.onclose=null}connect(t,e){var n=this;return(0,u.Z)(function*(){return v.isRequired(t,"url"),v.isRequired(e,"transferFormat"),v.isIn(e,w,"transferFormat"),n._logger.log(c.Trace,"(SSE transport) Connecting."),n._url=t,n._accessToken&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(n._accessToken)}`),new Promise((r,s)=>{let l,a=!1;if(e===w.Text){if(b.isBrowser||b.isWebWorker)l=new n._options.EventSource(t,{withCredentials:n._options.withCredentials});else{const h=n._httpClient.getCookieString(t),d={};d.Cookie=h;const[g,p]=E();d[g]=p,l=new n._options.EventSource(t,{withCredentials:n._options.withCredentials,headers:{...d,...n._options.headers}})}try{l.onmessage=h=>{if(n.onreceive)try{n._logger.log(c.Trace,`(SSE transport) data received. ${R(h.data,n._options.logMessageContent)}.`),n.onreceive(h.data)}catch(d){return void n._close(d)}},l.onerror=h=>{a?n._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},l.onopen=()=>{n._logger.log(c.Information,`SSE connected to ${n._url}`),n._eventSource=l,a=!0,r()}}catch(h){return void s(h)}}else s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})})()}send(t){var e=this;return(0,u.Z)(function*(){return e._eventSource?te(e._logger,"SSE",e._httpClient,e._url,t,e._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){return this._close(),Promise.resolve()}_close(t){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(t))}}class De{constructor(t,e,n,r,s,a){this._logger=n,this._accessTokenFactory=e,this._logMessageContent=r,this._webSocketConstructor=s,this._httpClient=t,this.onreceive=null,this.onclose=null,this._headers=a}connect(t,e){var n=this;return(0,u.Z)(function*(){let r;return v.isRequired(t,"url"),v.isRequired(e,"transferFormat"),v.isIn(e,w,"transferFormat"),n._logger.log(c.Trace,"(WebSockets transport) Connecting."),n._accessTokenFactory&&(r=yield n._accessTokenFactory()),new Promise((s,a)=>{let l;t=t.replace(/^http/,"ws");const h=n._httpClient.getCookieString(t);let d=!1;if(b.isNode||b.isReactNative){const g={},[p,N]=E();g[p]=N,r&&(g[D.Authorization]=`Bearer ${r}`),h&&(g[D.Cookie]=h),l=new n._webSocketConstructor(t,void 0,{headers:{...g,...n._headers}})}else r&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);l||(l=new n._webSocketConstructor(t)),e===w.Binary&&(l.binaryType="arraybuffer"),l.onopen=g=>{n._logger.log(c.Information,`WebSocket connected to ${t}.`),n._webSocket=l,d=!0,s()},l.onerror=g=>{let p=null;p=typeof ErrorEvent<"u"&&g instanceof ErrorEvent?g.error:"There was an error with the transport",n._logger.log(c.Information,`(WebSockets transport) ${p}.`)},l.onmessage=g=>{if(n._logger.log(c.Trace,`(WebSockets transport) data received. ${R(g.data,n._logMessageContent)}.`),n.onreceive)try{n.onreceive(g.data)}catch(p){return void n._close(p)}},l.onclose=g=>{if(d)n._close(g);else{let p=null;p=typeof ErrorEvent<"u"&&g instanceof ErrorEvent?g.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",a(new Error(p))}}})})()}send(t){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(c.Trace,`(WebSockets transport) sending data. ${R(t,this._logMessageContent)}.`),this._webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(t){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(c.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(t)||!1!==t.wasClean&&1e3===t.code?t instanceof Error?this.onclose(t):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${t.code} (${t.reason||"no reason given"}).`)))}_isCloseEvent(t){return t&&"boolean"==typeof t.wasClean&&"number"==typeof t.code}}class Me{constructor(t,e={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,v.isRequired(t,"url"),this._logger=function be(i){return void 0===i?new O(c.Information):null===i?M.instance:void 0!==i.log?i:new O(i)}(e.logger),this.baseUrl=this._resolveUrl(t),(e=e||{}).logMessageContent=void 0!==e.logMessageContent&&e.logMessageContent,"boolean"!=typeof e.withCredentials&&void 0!==e.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");e.withCredentials=void 0===e.withCredentials||e.withCredentials,e.timeout=void 0===e.timeout?1e5:e.timeout;let n=null,r=null;if(b.isNode){const s=require;n=s("ws"),r=s("eventsource")}!b.isNode&&typeof WebSocket<"u"&&!e.WebSocket?e.WebSocket=WebSocket:b.isNode&&!e.WebSocket&&n&&(e.WebSocket=n),!b.isNode&&typeof EventSource<"u"&&!e.EventSource?e.EventSource=EventSource:b.isNode&&!e.EventSource&&typeof r<"u"&&(e.EventSource=r),this._httpClient=new ue(e.httpClient||new Ee(this._logger),e.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=e,this.onreceive=null,this.onclose=null}start(t){var e=this;return(0,u.Z)(function*(){if(v.isIn(t=t||w.Binary,w,"transferFormat"),e._logger.log(c.Debug,`Starting connection with transfer format '${w[t]}'.`),"Disconnected"!==e._connectionState)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(e._connectionState="Connecting",e._startInternalPromise=e._startInternal(t),yield e._startInternalPromise,"Disconnecting"===e._connectionState){const n="Failed to start the HttpConnection before stop() was called.";return e._logger.log(c.Error,n),yield e._stopPromise,Promise.reject(new S(n))}if("Connected"!==e._connectionState){const n="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return e._logger.log(c.Error,n),Promise.reject(new S(n))}e._connectionStarted=!0})()}send(t){return"Connected"!==this._connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new B(this.transport)),this._sendQueue.send(t))}stop(t){var e=this;return(0,u.Z)(function*(){return"Disconnected"===e._connectionState?(e._logger.log(c.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===e._connectionState?(e._logger.log(c.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),e._stopPromise):(e._connectionState="Disconnecting",e._stopPromise=new Promise(n=>{e._stopPromiseResolver=n}),yield e._stopInternal(t),void(yield e._stopPromise))})()}_stopInternal(t){var e=this;return(0,u.Z)(function*(){e._stopError=t;try{yield e._startInternalPromise}catch{}if(e.transport){try{yield e.transport.stop()}catch(n){e._logger.log(c.Error,`HttpConnection.transport.stop() threw error '${n}'.`),e._stopConnection()}e.transport=void 0}else e._logger.log(c.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")})()}_startInternal(t){var e=this;return(0,u.Z)(function*(){let n=e.baseUrl;e._accessTokenFactory=e._options.accessTokenFactory,e._httpClient._accessTokenFactory=e._accessTokenFactory;try{if(e._options.skipNegotiation){if(e._options.transport!==C.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");e.transport=e._constructTransport(C.WebSockets),yield e._startTransport(n,t)}else{let r=null,s=0;do{if(r=yield e._getNegotiationResponse(n),"Disconnecting"===e._connectionState||"Disconnected"===e._connectionState)throw new S("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(n=r.url),r.accessToken){const a=r.accessToken;e._accessTokenFactory=()=>a,e._httpClient._accessToken=a,e._httpClient._accessTokenFactory=void 0}s++}while(r.url&&s<100);if(100===s&&r.url)throw new Error("Negotiate redirection limit exceeded.");yield e._createTransport(n,e._options.transport,r,t)}e.transport instanceof re&&(e.features.inherentKeepAlive=!0),"Connecting"===e._connectionState&&(e._logger.log(c.Debug,"The HttpConnection connected successfully."),e._connectionState="Connected")}catch(r){return e._logger.log(c.Error,"Failed to start the connection: "+r),e._connectionState="Disconnected",e.transport=void 0,e._stopPromiseResolver(),Promise.reject(r)}})()}_getNegotiationResponse(t){var e=this;return(0,u.Z)(function*(){const n={},[r,s]=E();n[r]=s;const a=e._resolveNegotiateUrl(t);e._logger.log(c.Debug,`Sending negotiation request: ${a}.`);try{const l=yield e._httpClient.post(a,{content:"",headers:{...n,...e._options.headers},timeout:e._options.timeout,withCredentials:e._options.withCredentials});if(200!==l.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${l.statusCode}'`));const h=JSON.parse(l.content);return(!h.negotiateVersion||h.negotiateVersion<1)&&(h.connectionToken=h.connectionId),h}catch(l){let h="Failed to complete negotiation with the server: "+l;return l instanceof I&&404===l.statusCode&&(h+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),e._logger.log(c.Error,h),Promise.reject(new fe(h))}})()}_createConnectUrl(t,e){return e?t+(-1===t.indexOf("?")?"?":"&")+`id=${e}`:t}_createTransport(t,e,n,r){var s=this;return(0,u.Z)(function*(){let a=s._createConnectUrl(t,n.connectionToken);if(s._isITransport(e))return s._logger.log(c.Debug,"Connection was provided an instance of ITransport, using that directly."),s.transport=e,yield s._startTransport(a,r),void(s.connectionId=n.connectionId);const l=[],h=n.availableTransports||[];let d=n;for(const g of h){const p=s._resolveTransportOrError(g,e,r);if(p instanceof Error)l.push(`${g.transport} failed:`),l.push(p);else if(s._isITransport(p)){if(s.transport=p,!d){try{d=yield s._getNegotiationResponse(t)}catch(N){return Promise.reject(N)}a=s._createConnectUrl(t,d.connectionToken)}try{return yield s._startTransport(a,r),void(s.connectionId=d.connectionId)}catch(N){if(s._logger.log(c.Error,`Failed to start the transport '${g.transport}': ${N}`),d=void 0,l.push(new pe(`${g.transport} failed: ${N}`,C[g.transport])),"Connecting"!==s._connectionState){const le="Failed to select transport before stop() was called.";return s._logger.log(c.Debug,le),Promise.reject(new S(le))}}}}return Promise.reject(l.length>0?new _e(`Unable to connect to the server with any of the available transports. ${l.join(" ")}`,l):new Error("None of the transports supported by the client are supported by the server."))})()}_constructTransport(t){switch(t){case C.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new De(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case C.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Pe(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case C.LongPolling:return new re(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${t}.`)}}_startTransport(t,e){return this.transport.onreceive=this.onreceive,this.transport.onclose=n=>this._stopConnection(n),this.transport.connect(t,e)}_resolveTransportOrError(t,e,n){const r=C[t.transport];if(null==r)return this._logger.log(c.Debug,`Skipping transport '${t.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${t.transport}' because it is not supported by this client.`);if(!function Re(i,t){return!i||0!=(t&i)}(e,r))return this._logger.log(c.Debug,`Skipping transport '${C[r]}' because it was disabled by the client.`),new ge(`'${C[r]}' is disabled by the client.`,r);if(!(t.transferFormats.map(a=>w[a]).indexOf(n)>=0))return this._logger.log(c.Debug,`Skipping transport '${C[r]}' because it does not support the requested transfer format '${w[n]}'.`),new Error(`'${C[r]}' does not support ${w[n]}.`);if(r===C.WebSockets&&!this._options.WebSocket||r===C.ServerSentEvents&&!this._options.EventSource)return this._logger.log(c.Debug,`Skipping transport '${C[r]}' because it is not supported in your environment.'`),new de(`'${C[r]}' is not supported in your environment.`,r);this._logger.log(c.Debug,`Selecting transport '${C[r]}'.`);try{return this._constructTransport(r)}catch(a){return a}}_isITransport(t){return t&&"object"==typeof t&&"connect"in t}_stopConnection(t){if(this._logger.log(c.Debug,`HttpConnection.stopConnection(${t}) called while in state ${this._connectionState}.`),this.transport=void 0,t=this._stopError||t,this._stopError=void 0,"Disconnected"!==this._connectionState){if("Connecting"===this._connectionState)throw this._logger.log(c.Warning,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${t}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this._connectionState&&this._stopPromiseResolver(),t?this._logger.log(c.Error,`Connection disconnected with error '${t}'.`):this._logger.log(c.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(e=>{this._logger.log(c.Error,`TransportSendQueue.stop() threw error '${e}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(e){this._logger.log(c.Error,`HttpConnection.onclose(${t}) threw error '${e}'.`)}}}else this._logger.log(c.Debug,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if(!b.isBrowser)throw new Error(`Cannot resolve '${t}'.`);const e=window.document.createElement("a");return e.href=t,this._logger.log(c.Information,`Normalizing '${t}' to '${e.href}'.`),e.href}_resolveNegotiateUrl(t){const e=t.indexOf("?");let n=t.substring(0,-1===e?t.length:e);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",n+=-1===e?"":t.substring(e),-1===n.indexOf("negotiateVersion")&&(n+=-1===e?"?":"&",n+="negotiateVersion="+this._negotiateVersion),n}}class B{constructor(t){this._transport=t,this._buffer=[],this._executing=!0,this._sendBufferedData=new H,this._transportResult=new H,this._sendLoopPromise=this._sendLoop()}send(t){return this._bufferData(t),this._transportResult||(this._transportResult=new H),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(t){if(this._buffer.length&&typeof this._buffer[0]!=typeof t)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof t}`);this._buffer.push(t),this._sendBufferedData.resolve()}_sendLoop(){var t=this;return(0,u.Z)(function*(){for(;;){if(yield t._sendBufferedData.promise,!t._executing){t._transportResult&&t._transportResult.reject("Connection stopped.");break}t._sendBufferedData=new H;const e=t._transportResult;t._transportResult=void 0;const n="string"==typeof t._buffer[0]?t._buffer.join(""):B._concatBuffers(t._buffer);t._buffer.length=0;try{yield t._transport.send(n),e.resolve()}catch(r){e.reject(r)}}})()}static _concatBuffers(t){const e=t.map(s=>s.byteLength).reduce((s,a)=>s+a),n=new Uint8Array(e);let r=0;for(const s of t)n.set(new Uint8Array(s),r),r+=s.byteLength;return n.buffer}}class H{constructor(){this.promise=new Promise((t,e)=>[this._resolver,this._rejecter]=[t,e])}resolve(){this._resolver()}reject(t){this._rejecter(t)}}class y{static write(t){return`${t}${y.RecordSeparator}`}static parse(t){if(t[t.length-1]!==y.RecordSeparator)throw new Error("Message is incomplete.");const e=t.split(y.RecordSeparator);return e.pop(),e}}y.RecordSeparatorCode=30,y.RecordSeparator=String.fromCharCode(y.RecordSeparatorCode);class $e{writeHandshakeRequest(t){return y.write(JSON.stringify(t))}parseHandshakeResponse(t){let e,n;if($(t)){const l=new Uint8Array(t),h=l.indexOf(y.RecordSeparatorCode);if(-1===h)throw new Error("Message is incomplete.");const d=h+1;e=String.fromCharCode.apply(null,Array.prototype.slice.call(l.slice(0,d))),n=l.byteLength>d?l.slice(d).buffer:null}else{const l=t,h=l.indexOf(y.RecordSeparator);if(-1===h)throw new Error("Message is incomplete.");const d=h+1;e=l.substring(0,d),n=l.length>d?l.substring(d):null}const r=y.parse(e),s=JSON.parse(r[0]);if(s.type)throw new Error("Expected a handshake response from the server.");return[n,s]}}var f=function(i){return i[i.Invocation=1]="Invocation",i[i.StreamItem=2]="StreamItem",i[i.Completion=3]="Completion",i[i.StreamInvocation=4]="StreamInvocation",i[i.CancelInvocation=5]="CancelInvocation",i[i.Ping=6]="Ping",i[i.Close=7]="Close",i}(f||{});class Ze{constructor(){this.observers=[]}next(t){for(const e of this.observers)e.next(t)}error(t){for(const e of this.observers)e.error&&e.error(t)}complete(){for(const t of this.observers)t.complete&&t.complete()}subscribe(t){return this.observers.push(t),new Ce(this,t)}}var m=function(i){return i.Disconnected="Disconnected",i.Connecting="Connecting",i.Connected="Connected",i.Disconnecting="Disconnecting",i.Reconnecting="Reconnecting",i}(m||{});class J{constructor(t,e,n,r){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(c.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},v.isRequired(t,"connection"),v.isRequired(e,"logger"),v.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this._logger=e,this._protocol=n,this.connection=t,this._reconnectPolicy=r,this._handshakeProtocol=new $e,this.connection.onreceive=s=>this._processIncomingData(s),this.connection.onclose=s=>this._connectionClosed(s),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=m.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:f.Ping})}static create(t,e,n,r){return new J(t,e,n,r)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(t){if(this._connectionState!==m.Disconnected&&this._connectionState!==m.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}_startWithStateTransitions(){var t=this;return(0,u.Z)(function*(){if(t._connectionState!==m.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));t._connectionState=m.Connecting,t._logger.log(c.Debug,"Starting HubConnection.");try{yield t._startInternal(),b.isBrowser&&window.document.addEventListener("freeze",t._freezeEventListener),t._connectionState=m.Connected,t._connectionStarted=!0,t._logger.log(c.Debug,"HubConnection connected successfully.")}catch(e){return t._connectionState=m.Disconnected,t._logger.log(c.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}})()}_startInternal(){var t=this;return(0,u.Z)(function*(){t._stopDuringStartError=void 0,t._receivedHandshakeResponse=!1;const e=new Promise((n,r)=>{t._handshakeResolver=n,t._handshakeRejecter=r});yield t.connection.start(t._protocol.transferFormat);try{const n={protocol:t._protocol.name,version:t._protocol.version};if(t._logger.log(c.Debug,"Sending handshake request."),yield t._sendMessage(t._handshakeProtocol.writeHandshakeRequest(n)),t._logger.log(c.Information,`Using HubProtocol '${t._protocol.name}'.`),t._cleanupTimeout(),t._resetTimeoutPeriod(),t._resetKeepAliveInterval(),yield e,t._stopDuringStartError)throw t._stopDuringStartError;t.connection.features.inherentKeepAlive||(yield t._sendMessage(t._cachedPingMessage))}catch(n){throw t._logger.log(c.Debug,`Hub handshake failed with error '${n}' during start(). Stopping HubConnection.`),t._cleanupTimeout(),t._cleanupPingTimer(),yield t.connection.stop(n),n}})()}stop(){var t=this;return(0,u.Z)(function*(){const e=t._startPromise;t._stopPromise=t._stopInternal(),yield t._stopPromise;try{yield e}catch{}})()}_stopInternal(t){return this._connectionState===m.Disconnected?(this._logger.log(c.Debug,`Call to HubConnection.stop(${t}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===m.Disconnecting?(this._logger.log(c.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=m.Disconnecting,this._logger.log(c.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(c.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=t||new S("The connection was stopped before the hub handshake could complete."),this.connection.stop(t)))}stream(t,...e){const[n,r]=this._replaceStreamingParams(e),s=this._createStreamInvocation(t,e,r);let a;const l=new Ze;return l.cancelCallback=()=>{const h=this._createCancelInvocation(s.invocationId);return delete this._callbacks[s.invocationId],a.then(()=>this._sendWithProtocol(h))},this._callbacks[s.invocationId]=(h,d)=>{d?l.error(d):h&&(h.type===f.Completion?h.error?l.error(new Error(h.error)):l.complete():l.next(h.item))},a=this._sendWithProtocol(s).catch(h=>{l.error(h),delete this._callbacks[s.invocationId]}),this._launchStreams(n,a),l}_sendMessage(t){return this._resetKeepAliveInterval(),this.connection.send(t)}_sendWithProtocol(t){return this._sendMessage(this._protocol.writeMessage(t))}send(t,...e){const[n,r]=this._replaceStreamingParams(e),s=this._sendWithProtocol(this._createInvocation(t,e,!0,r));return this._launchStreams(n,s),s}invoke(t,...e){const[n,r]=this._replaceStreamingParams(e),s=this._createInvocation(t,e,!1,r);return new Promise((l,h)=>{this._callbacks[s.invocationId]=(g,p)=>{p?h(p):g&&(g.type===f.Completion?g.error?h(new Error(g.error)):l(g.result):h(new Error(`Unexpected message type: ${g.type}`)))};const d=this._sendWithProtocol(s).catch(g=>{h(g),delete this._callbacks[s.invocationId]});this._launchStreams(n,d)})}on(t,e){!t||!e||(t=t.toLowerCase(),this._methods[t]||(this._methods[t]=[]),-1===this._methods[t].indexOf(e)&&this._methods[t].push(e))}off(t,e){if(!t)return;t=t.toLowerCase();const n=this._methods[t];if(n)if(e){const r=n.indexOf(e);-1!==r&&(n.splice(r,1),0===n.length&&delete this._methods[t])}else delete this._methods[t]}onclose(t){t&&this._closedCallbacks.push(t)}onreconnecting(t){t&&this._reconnectingCallbacks.push(t)}onreconnected(t){t&&this._reconnectedCallbacks.push(t)}_processIncomingData(t){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(t=this._processHandshakeResponse(t),this._receivedHandshakeResponse=!0),t){const e=this._protocol.parseMessages(t,this._logger);for(const n of e)switch(n.type){case f.Invocation:this._invokeClientMethod(n);break;case f.StreamItem:case f.Completion:{const r=this._callbacks[n.invocationId];if(r){n.type===f.Completion&&delete this._callbacks[n.invocationId];try{r(n)}catch(s){this._logger.log(c.Error,`Stream callback threw error: ${ne(s)}`)}}break}case f.Ping:break;case f.Close:{this._logger.log(c.Information,"Close message received from server.");const r=n.error?new Error("Server returned an error on close: "+n.error):void 0;!0===n.allowReconnect?this.connection.stop(r):this._stopPromise=this._stopInternal(r);break}default:this._logger.log(c.Warning,`Invalid message type: ${n.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(t){let e,n;try{[n,e]=this._handshakeProtocol.parseHandshakeResponse(t)}catch(r){const s="Error parsing handshake response: "+r;this._logger.log(c.Error,s);const a=new Error(s);throw this._handshakeRejecter(a),a}if(e.error){const r="Server returned handshake error: "+e.error;this._logger.log(c.Error,r);const s=new Error(r);throw this._handshakeRejecter(s),s}return this._logger.log(c.Debug,"Server handshake complete."),this._handshakeResolver(),n}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){var t=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),void 0!==this._pingServerHandle))){let e=this._nextKeepAlive-(new Date).getTime();e<0&&(e=0),this._pingServerHandle=setTimeout((0,u.Z)(function*(){if(t._connectionState===m.Connected)try{yield t._sendMessage(t._cachedPingMessage)}catch{t._cleanupPingTimer()}}),e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(t){var e=this;return(0,u.Z)(function*(){const n=t.target.toLowerCase(),r=e._methods[n];if(!r)return e._logger.log(c.Warning,`No client method with the name '${n}' found.`),void(t.invocationId&&(e._logger.log(c.Warning,`No result given for '${n}' method and invocation ID '${t.invocationId}'.`),yield e._sendWithProtocol(e._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null))));const s=r.slice(),a=!!t.invocationId;let l,h,d;for(const g of s)try{const p=l;l=yield g.apply(e,t.arguments),a&&l&&p&&(e._logger.log(c.Error,`Multiple results provided for '${n}'. Sending error to server.`),d=e._createCompletionMessage(t.invocationId,"Client provided multiple results.",null)),h=void 0}catch(p){h=p,e._logger.log(c.Error,`A callback for the method '${n}' threw error '${p}'.`)}d?yield e._sendWithProtocol(d):a?(h?d=e._createCompletionMessage(t.invocationId,`${h}`,null):void 0!==l?d=e._createCompletionMessage(t.invocationId,null,l):(e._logger.log(c.Warning,`No result given for '${n}' method and invocation ID '${t.invocationId}'.`),d=e._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null)),yield e._sendWithProtocol(d)):l&&e._logger.log(c.Error,`Result given for '${n}' method but server is not expecting a result.`)})()}_connectionClosed(t){this._logger.log(c.Debug,`HubConnection.connectionClosed(${t}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||t||new S("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===m.Disconnecting?this._completeClose(t):this._connectionState===m.Connected&&this._reconnectPolicy?this._reconnect(t):this._connectionState===m.Connected&&this._completeClose(t)}_completeClose(t){if(this._connectionStarted){this._connectionState=m.Disconnected,this._connectionStarted=!1,b.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(e=>e.apply(this,[t]))}catch(e){this._logger.log(c.Error,`An onclose callback called with error '${t}' threw error '${e}'.`)}}}_reconnect(t){var e=this;return(0,u.Z)(function*(){const n=Date.now();let r=0,s=void 0!==t?t:new Error("Attempting to reconnect due to a unknown error."),a=e._getNextRetryDelay(r++,0,s);if(null===a)return e._logger.log(c.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void e._completeClose(t);if(e._connectionState=m.Reconnecting,e._logger.log(c.Information,t?`Connection reconnecting because of error '${t}'.`:"Connection reconnecting."),0!==e._reconnectingCallbacks.length){try{e._reconnectingCallbacks.forEach(l=>l.apply(e,[t]))}catch(l){e._logger.log(c.Error,`An onreconnecting callback called with error '${t}' threw error '${l}'.`)}if(e._connectionState!==m.Reconnecting)return void e._logger.log(c.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==a;){if(e._logger.log(c.Information,`Reconnect attempt number ${r} will start in ${a} ms.`),yield new Promise(l=>{e._reconnectDelayHandle=setTimeout(l,a)}),e._reconnectDelayHandle=void 0,e._connectionState!==m.Reconnecting)return void e._logger.log(c.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(yield e._startInternal(),e._connectionState=m.Connected,e._logger.log(c.Information,"HubConnection reconnected successfully."),0!==e._reconnectedCallbacks.length)try{e._reconnectedCallbacks.forEach(l=>l.apply(e,[e.connection.connectionId]))}catch(l){e._logger.log(c.Error,`An onreconnected callback called with connectionId '${e.connection.connectionId}; threw error '${l}'.`)}return}catch(l){if(e._logger.log(c.Information,`Reconnect attempt failed because of error '${l}'.`),e._connectionState!==m.Reconnecting)return e._logger.log(c.Debug,`Connection moved to the '${e._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(e._connectionState===m.Disconnecting&&e._completeClose());s=l instanceof Error?l:new Error(l.toString()),a=e._getNextRetryDelay(r++,Date.now()-n,s)}}e._logger.log(c.Information,`Reconnect retries have been exhausted after ${Date.now()-n} ms and ${r} failed attempts. Connection disconnecting.`),e._completeClose()})()}_getNextRetryDelay(t,e,n){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:t,retryReason:n})}catch(r){return this._logger.log(c.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${t}, ${e}) threw error '${r}'.`),null}}_cancelCallbacksWithError(t){const e=this._callbacks;this._callbacks={},Object.keys(e).forEach(n=>{const r=e[n];try{r(null,t)}catch(s){this._logger.log(c.Error,`Stream 'error' callback called with '${t}' threw error: ${ne(s)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(t,e,n,r){if(n)return 0!==r.length?{arguments:e,streamIds:r,target:t,type:f.Invocation}:{arguments:e,target:t,type:f.Invocation};{const s=this._invocationId;return this._invocationId++,0!==r.length?{arguments:e,invocationId:s.toString(),streamIds:r,target:t,type:f.Invocation}:{arguments:e,invocationId:s.toString(),target:t,type:f.Invocation}}}_launchStreams(t,e){if(0!==t.length){e||(e=Promise.resolve());for(const n in t)t[n].subscribe({complete:()=>{e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(n)))},error:r=>{let s;s=r instanceof Error?r.message:r&&r.toString?r.toString():"Unknown error",e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(n,s)))},next:r=>{e=e.then(()=>this._sendWithProtocol(this._createStreamItemMessage(n,r)))}})}}_replaceStreamingParams(t){const e=[],n=[];for(let r=0;r<t.length;r++){const s=t[r];if(this._isObservable(s)){const a=this._invocationId;this._invocationId++,e[a]=s,n.push(a.toString()),t.splice(r,1)}}return[e,n]}_isObservable(t){return t&&t.subscribe&&"function"==typeof t.subscribe}_createStreamInvocation(t,e,n){const r=this._invocationId;return this._invocationId++,0!==n.length?{arguments:e,invocationId:r.toString(),streamIds:n,target:t,type:f.StreamInvocation}:{arguments:e,invocationId:r.toString(),target:t,type:f.StreamInvocation}}_createCancelInvocation(t){return{invocationId:t,type:f.CancelInvocation}}_createStreamItemMessage(t,e){return{invocationId:t,item:e,type:f.StreamItem}}_createCompletionMessage(t,e,n){return e?{error:e,invocationId:t,type:f.Completion}:{invocationId:t,result:n,type:f.Completion}}}class He{constructor(){this.name="json",this.version=1,this.transferFormat=w.Text}parseMessages(t,e){if("string"!=typeof t)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];null===e&&(e=M.instance);const n=y.parse(t),r=[];for(const s of n){const a=JSON.parse(s);if("number"!=typeof a.type)throw new Error("Invalid payload.");switch(a.type){case f.Invocation:this._isInvocationMessage(a);break;case f.StreamItem:this._isStreamItemMessage(a);break;case f.Completion:this._isCompletionMessage(a);break;case f.Ping:case f.Close:break;default:e.log(c.Information,"Unknown message type '"+a.type+"' ignored.");continue}r.push(a)}return r}writeMessage(t){return y.write(JSON.stringify(t))}_isInvocationMessage(t){this._assertNotEmptyString(t.target,"Invalid payload for Invocation message."),void 0!==t.invocationId&&this._assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(t){if(this._assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),void 0===t.item)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this._assertNotEmptyString(t.error,"Invalid payload for Completion message."),this._assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(t,e){if("string"!=typeof t||""===t)throw new Error(e)}}const We={trace:c.Trace,debug:c.Debug,info:c.Information,information:c.Information,warn:c.Warning,warning:c.Warning,error:c.Error,critical:c.Critical,none:c.None};class je{configureLogging(t){if(v.isRequired(t,"logging"),function Fe(i){return void 0!==i.log}(t))this.logger=t;else if("string"==typeof t){const e=function Ge(i){const t=We[i.toLowerCase()];if(typeof t<"u")return t;throw new Error(`Unknown log level: ${i}`)}(t);this.logger=new O(e)}else this.logger=new O(t);return this}withUrl(t,e){return v.isRequired(t,"url"),v.isNotEmpty(t,"url"),this.url=t,this.httpConnectionOptions="object"==typeof e?{...this.httpConnectionOptions,...e}:{...this.httpConnectionOptions,transport:e},this}withHubProtocol(t){return v.isRequired(t,"protocol"),this.protocol=t,this}withAutomaticReconnect(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return this.reconnectPolicy=t?Array.isArray(t)?new V(t):t:new V,this}build(){const t=this.httpConnectionOptions||{};if(void 0===t.logger&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const e=new Me(this.url,t);return J.create(e,this.logger||M.instance,this.protocol||new He,this.reconnectPolicy)}}var se=_(553),W=_(708),Le=_(1893),Be=_(9862);let Je=(()=>{class i{constructor(e){this.http=e}getOldMessages(e){return this.http.get(`${se.N.appUrl}/messagechat/messages-of-group?groupId=${e}`)}}return i.\u0275fac=function(e){return new(e||i)(o.LFG(Be.eN))},i.\u0275prov=o.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var ce=_(2416),G=_(6070);let z=(()=>{class i{constructor(e,n,r,s){this.groupService=e,this.messageService=n,this.accountService=r,this.shareService=s,this.groupId="",this.groupName="",this.myName="",this.userId="",this.connectionId="",this.messages=[],this.usersOnline=[],this.groups=[]}createChatConnection(){var e=this;return(0,u.Z)(function*(){"Connected"!==e.chatConnection?.state&&(e.chatConnection=(new je).withUrl(`${se.N.hupUrl}/hubs/chat`).withAutomaticReconnect().build(),yield e.getMyName(),yield e.startConnection(),yield e.getGroupsOfUser(),yield e.JoinGroup(),yield e.getOldMessages(),yield e.addOnlineUser(),yield e.getOnlineUsers()),e.chatConnection.on("UserConected",function(){var n=(0,u.Z)(function*(r){});return function(r){return n.apply(this,arguments)}}()),e.chatConnection.on("NewOnlineUser",function(){var n=(0,u.Z)(function*(r){!1===e.usersOnline.includes(r)&&(e.usersOnline=[...e.usersOnline,r])});return function(r){return n.apply(this,arguments)}}()),e.chatConnection.on("NewGroup",function(){var n=(0,u.Z)(function*(r){"string"==typeof r?e.shareService.showDialog(!1,"Error",r):(e.groups=[...e.groups,r],e.groupName=r.name,e.groupId=r.id,yield e.addOnlineUser(),yield e.getOnlineUsers(),e.JoinGroup())});return function(r){return n.apply(this,arguments)}}()),e.chatConnection.on("LeaveGroup",function(){var n=(0,u.Z)(function*(r){e.groups=e.groups.filter(s=>s.id!==r),e.groups.length>0?(e.groupId=e.groups[0].id,e.groupName=e.groups[0].name,yield e.getOldMessages(),yield e.addOnlineUser(),yield e.getOnlineUsers(),e.JoinGroup()):(e.groupId="",e.groupName="")});return function(r){return n.apply(this,arguments)}}()),e.chatConnection.on("LeaveGroupOthers",function(){var n=(0,u.Z)(function*(r){e.usersOnline=e.usersOnline.filter(s=>s!==r)});return function(r){return n.apply(this,arguments)}}()),e.chatConnection.on("NewMessage",function(){var n=(0,u.Z)(function*(r){e.messages=[...e.messages,r]});return function(r){return n.apply(this,arguments)}}()),e.chatConnection.on("RemoveOnlineUser",function(){var n=(0,u.Z)(function*(r){e.usersOnline=e.usersOnline.filter(s=>s!==r)});return function(r){return n.apply(this,arguments)}}()),e.chatConnection.on("AddedToGroup",function(){var n=(0,u.Z)(function*(r){e.groups=[...e.groups,r],1==e.groups.length&&(e.groupName=r.name,e.groupId=r.id,e.JoinGroup(),yield e.getOldMessages(),yield e.addOnlineUser(),yield e.getOnlineUsers())});return function(r){return n.apply(this,arguments)}}()),e.chatConnection.on("GroupHasNewMessage",function(){var n=(0,u.Z)(function*(r){const s=e.groups.find(a=>a.name===r);s&&r!==e.groupName&&(s.hasNewMessage=!0,yield e.sethasNewMess(s,!0))});return function(r){return n.apply(this,arguments)}}())})()}startConnection(){var e=this;return(0,u.Z)(function*(){yield e.chatConnection?.start().catch(n=>{console.log(n)})})()}disConnentGroup(e,n){var r=this;return(0,u.Z)(function*(){return r.chatConnection?.invoke("DisConnectedGroup",e,r.myName).catch(s=>{console.log(s)})})()}stopConnection(){var e=this;return(0,u.Z)(function*(){yield e.removeOnlineUser(e.groupName,e.myName),yield e.disConnentGroup(e.groupName,e.myName),yield e.chatConnection?.stop().catch(n=>{console.log(n)})})()}getMyName(){var e=this;return(0,u.Z)(function*(){e.accountService.user$.pipe((0,q.q)(1)).subscribe({next:n=>{n&&(e.myName=n.firstName+" "+n.lastName)},error:n=>{console.log(n)}})})()}getGroupsOfUser(){var e=this;return(0,u.Z)(function*(){return yield(0,W.n)(e.groupService.getGroupsOfUser(e.userId)).then(r=>{r.length>0&&(e.groups=r,e.groupName=r[0].name,e.groupId=r[0].id)}).catch(r=>{console.log(r)})})()}JoinGroup(){var e=this;return(0,u.Z)(function*(){return e.chatConnection?.invoke("ConnectGroup",e.groupName,e.userId).then(()=>{e.connectionId=e.chatConnection?.connectionId}).catch(n=>{console.log(n)})})()}addGroupUser(e){this.messages=[],this.chatConnection?.invoke("AddNewGroup",e,this.userId).catch(n=>{console.log(n)})}leaveGroup(e){var n=this;return(0,u.Z)(function*(){return n.chatConnection?.invoke("LeaveGroup",e.id,n.userId).then((0,u.Z)(function*(){yield n.removeOnlineUser(e.name,n.myName),yield n.disConnentGroup(e.name,n.myName)})).catch(r=>{console.log(r)})})()}getOldMessages(){var e=this;return(0,u.Z)(function*(){return""===e.groupId?void 0:yield(0,W.n)(e.messageService.getOldMessages(e.groupId)).then(r=>{r&&(e.messages=r)}).catch(r=>{console.log(r)})})()}sendMessage(e){var n=this;return(0,u.Z)(function*(){const r={sender:n.myName,content:e};return n.chatConnection?.invoke("RecieveMessage",n.groupName,n.groupId,r).catch(s=>{console.log(s)})})()}switchGroup(e){var n=this;return(0,u.Z)(function*(){n.removeOnlineUser(n.groupName,n.myName),n.disConnentGroup(n.groupName,n.myName),n.groupId=e.id,n.groupName=e.name,e.hasNewMessage=!1,n.usersOnline=[],n.messages=[],n.JoinGroup(),yield n.getOldMessages(),yield n.addOnlineUser(),yield n.getOnlineUsers(),yield n.sethasNewMess(e,!1)})()}addOnlineUser(){var e=this;return(0,u.Z)(function*(){return""===e.groupName?void 0:yield(0,W.n)(e.groupService.addOnlineUser(e.groupName,e.myName)).then(r=>e.chatConnection?.invoke("AddUsersOnline",e.groupName,r.userOnline).catch(s=>{console.log(s)})).catch(r=>{console.log(r)})})()}removeOnlineUser(e,n){var r=this;return(0,u.Z)(function*(){return r.chatConnection?.invoke("RemoveOnlineUser",e,n).catch(s=>{console.log(s)})})()}getOnlineUsers(){var e=this;return(0,u.Z)(function*(){return""===e.groupName?void 0:yield(0,W.n)(e.groupService.getUsersOnline(e.groupName)).then(r=>{e.usersOnline=r})})()}addMemberToGroup(e){this.groupService.addUserToGroup(e,this.groupId).subscribe({next:n=>{this.chatConnection?.invoke("AddedToGroup",e,this.groupId).catch(r=>{console.log(r)}),this.shareService.showDialog(!0,"Success","Add member successfully")},error:n=>{console.log(n)}})}sethasNewMess(e,n){var r=this;return(0,u.Z)(function*(){return r.chatConnection?.invoke("SetHasNewMessage",e.id,n).catch(s=>{console.log(s)})})()}}return i.\u0275fac=function(e){return new(e||i)(o.LFG(Le.l),o.LFG(Je),o.LFG(ce.B),o.LFG(G.F))},i.\u0275prov=o.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var j=_(617);let ze=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=o.Xpm({type:i,selectors:[["app-menu"]],decls:6,vars:0,consts:[[1,"h-full"],[1,"text-white","bg-blue-800","h-full","flex","flex-col","gap-2","items-center","p-3"],["routerLink","/chat-rooms"],["routerLink","/chat-rooms/search-member"]],template:function(e,n){1&e&&(o.TgZ(0,"div",0)(1,"div",1)(2,"mat-icon",2),o._uU(3,"home"),o.qZA(),o.TgZ(4,"mat-icon",3),o._uU(5,"search"),o.qZA()()())},dependencies:[A.rH,j.Hw]}),i})(),Ye=(()=>{class i{constructor(e,n,r){this.chatService=e,this.accountService=n,this.sharedService=r}ngOnDestroy(){this.chatService.stopConnection()}ngOnInit(){this.chatService.createChatConnection(),this.getUserId()}getUserId(){this.accountService.user$.pipe((0,q.q)(1)).subscribe({next:e=>{e&&(this.chatService.userId=e.id)},error:e=>{console.log(e)}})}}return i.\u0275fac=function(e){return new(e||i)(o.Y36(z),o.Y36(ce.B),o.Y36(G.F))},i.\u0275cmp=o.Xpm({type:i,selectors:[["app-room"]],decls:6,vars:0,consts:[[1,"w-full","min-h-screen","h-screen"],[1,"flex","w-screen","h-full"],[1,""],[1,"w-full"]],template:function(e,n){1&e&&(o.TgZ(0,"div",0)(1,"div",1)(2,"div",2),o._UZ(3,"app-menu"),o.qZA(),o.TgZ(4,"div",3),o._UZ(5,"router-outlet"),o.qZA()()())},dependencies:[A.lC,ze]}),i})();var Y=_(1476),Qe=_(3019),k=_(7700),Z=_(5683),Q=_(2296),T=_(6223),K=_(2032);let ae=(()=>{class i{constructor(e,n){this.dialogRef=e,this.data=n,this.email=""}onNoClick(){this.dialogRef.close()}}return i.\u0275fac=function(e){return new(e||i)(o.Y36(k.so),o.Y36(k.WI))},i.\u0275cmp=o.Xpm({type:i,selectors:[["app-input-data"]],decls:12,vars:4,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["matInput","",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(e,n){1&e&&(o.TgZ(0,"h1",0),o._uU(1),o.qZA(),o.TgZ(2,"div",1)(3,"mat-form-field")(4,"mat-label"),o._uU(5),o.qZA(),o.TgZ(6,"input",2),o.NdJ("ngModelChange",function(s){return n.email=s}),o.qZA()()(),o.TgZ(7,"div",3)(8,"button",4),o.NdJ("click",function(){return n.onNoClick()}),o._uU(9,"Cancel"),o.qZA(),o.TgZ(10,"button",5),o._uU(11,"Ok"),o.qZA()()),2&e&&(o.xp6(1),o.Oqu(n.data.title),o.xp6(4),o.Oqu(n.data.title),o.xp6(1),o.Q6J("ngModel",n.email),o.xp6(4),o.Q6J("mat-dialog-close",n.email))},dependencies:[Z.KE,Z.hX,k.ZT,k.uh,k.xY,k.H8,Q.lW,T.Fj,T.JJ,T.On,K.Nt]}),i})();var Ke=_(2048),x=_(5313);function Xe(i,t){1&i&&(o.TgZ(0,"div",9),o._uU(1," No Memeber\n"),o.qZA())}function qe(i,t){1&i&&(o.TgZ(0,"th",19),o._uU(1,"Name"),o.qZA())}function Ve(i,t){if(1&i&&(o.TgZ(0,"td",20),o._uU(1),o.qZA()),2&i){const e=t.$implicit;o.xp6(1),o.hij(" ",e.firstName+" "+e.lastName," ")}}function et(i,t){1&i&&(o.TgZ(0,"th",19),o._uU(1,"DateCreated"),o.qZA())}function tt(i,t){if(1&i&&(o.TgZ(0,"td",20),o._uU(1),o.ALo(2,"date"),o.qZA()),2&i){const e=t.$implicit;o.xp6(1),o.Oqu(o.lcZ(2,1,e.dateCreated))}}function nt(i,t){1&i&&(o.TgZ(0,"th",19),o._uU(1,"Options"),o.qZA())}function ot(i,t){if(1&i){const e=o.EpF();o.TgZ(0,"td",20)(1,"button",21),o.NdJ("click",function(){const s=o.CHM(e).$implicit,a=o.oxw(2);return o.KtG(a.addUserToGroup(s))}),o.TgZ(2,"mat-icon"),o._uU(3,"add_box"),o.qZA()()()}}function rt(i,t){1&i&&o._UZ(0,"tr",22)}function it(i,t){1&i&&o._UZ(0,"tr",23)}function st(i,t){if(1&i&&(o.TgZ(0,"div",10)(1,"table",11),o.ynx(2,12),o.YNc(3,qe,2,0,"th",13),o.YNc(4,Ve,2,1,"td",14),o.BQk(),o.ynx(5,15),o.YNc(6,et,2,0,"th",13),o.YNc(7,tt,3,3,"td",14),o.BQk(),o.ynx(8,16),o.YNc(9,nt,2,0,"th",13),o.YNc(10,ot,4,0,"td",14),o.BQk(),o.YNc(11,rt,1,0,"tr",17),o.YNc(12,it,1,0,"tr",18),o.qZA()()),2&i){const e=o.oxw();o.xp6(1),o.Q6J("dataSource",e.data),o.xp6(10),o.Q6J("matHeaderRowDef",e.displayedColumns),o.xp6(1),o.Q6J("matRowDefColumns",e.displayedColumns)}}const ct=function(i){return{hidden:i}};let at=(()=>{class i{constructor(e,n,r,s){this.adminService=e,this.dialog=n,this.chatService=r,this.sharedService=s,this.searchString="",this.data=[],this.length=0,this.pageSize=6,this.displayedColumns=["Name","DateCreated","Options"]}ngAfterViewInit(){(0,Qe.T)(this.paginator.page).subscribe({next:e=>{this.adminService.getUsers(this.paginator.pageIndex,this.pageSize).subscribe({next:n=>{this.data=n.users},error:n=>{console.log(n)}})}})}getUserByname(){this.adminService.searchUserByName(this.searchString,this.paginator.pageIndex,this.pageSize).subscribe({next:e=>{this.data=e.users,this.length=e.size},error:e=>{console.log(e)}})}searchName(){this.paginator.pageIndex=0,""!==this.searchString&&this.getUserByname()}addUserToGroup(e){this.dialog.open(ae,{data:{title:"Enter group name",data:"hello"}}).afterClosed().subscribe(r=>{const s=this.chatService.groups.map(a=>a.name);""===r.trim()||!1===s.includes(r)?this.sharedService.showDialog(!1,"Error","Group name is not existed."):this.chatService.addMemberToGroup(e.email)})}}return i.\u0275fac=function(e){return new(e||i)(o.Y36(Ke.l),o.Y36(k.uw),o.Y36(z),o.Y36(G.F))},i.\u0275cmp=o.Xpm({type:i,selectors:[["app-search-member"]],viewQuery:function(e,n){if(1&e&&o.Gf(Y.NW,5),2&e){let r;o.iGM(r=o.CRH())&&(n.paginator=r.first)}},decls:14,vars:9,consts:[[1,"mt-4","ml-4","flex","items-center","justify-between","gap-2"],[1,"example-container","flex","gap-2"],["mat-fab","","color","primary","aria-label","Example icon button with a home icon",3,"click"],[1,"w-[300px]"],["name","searchString","matInput","","placeholder","Name",3,"ngModel","ngModelChange"],["class","font-bold text-[3em] text-center my-10",4,"ngIf"],[1,"example-container","mat-elevation-z8"],["class","example-table-container",4,"ngIf"],["aria-label","",3,"length","pageSize"],[1,"font-bold","text-[3em]","text-center","my-10"],[1,"example-table-container"],["mat-table","","matSort","","matSortActive","created","matSortDisableClear","","matSortDirection","asc",1,"example-table",3,"dataSource"],["matColumnDef","Name"],["class","font-bold","mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","DateCreated"],["matColumnDef","Options"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"font-bold"],["mat-cell",""],[1,"bg-blue-300","py-1","px-4","rounded-md","hover:bg-blue-500","hover:text-white","duration-75",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,n){1&e&&(o.TgZ(0,"div",0)(1,"div",1)(2,"button",2),o.NdJ("click",function(){return n.searchName()}),o.TgZ(3,"mat-icon"),o._uU(4,"search"),o.qZA()(),o.TgZ(5,"mat-form-field",3)(6,"mat-label"),o._uU(7,"Search"),o.qZA(),o.TgZ(8,"input",4),o.NdJ("ngModelChange",function(s){return n.searchString=s}),o.qZA()()()(),o.YNc(9,Xe,2,0,"div",5),o.TgZ(10,"div",6),o.YNc(11,st,13,3,"div",7),o.TgZ(12,"div"),o._UZ(13,"mat-paginator",8),o.qZA()()),2&e&&(o.xp6(8),o.Q6J("ngModel",n.searchString),o.xp6(1),o.Q6J("ngIf",n.data.length<=0),o.xp6(2),o.Q6J("ngIf",n.data.length>0),o.xp6(1),o.Tol(o.VKq(7,ct,n.data.length<=0)),o.xp6(1),o.Q6J("length",n.length)("pageSize",n.pageSize))},dependencies:[P.O5,j.Hw,Q.cs,T.Fj,T.JJ,T.On,K.Nt,Z.KE,Z.hX,Y.NW,x.BZ,x.fO,x.as,x.w1,x.Dz,x.nj,x.ge,x.ev,x.XQ,x.Gk,P.uU]}),i})();const lt=["messBox"];function ht(i,t){if(1&i){const e=o.EpF();o.TgZ(0,"li",11)(1,"div",12)(2,"div",13),o.NdJ("click",function(){const s=o.CHM(e).$implicit,a=o.oxw();return o.KtG(a.switchGroup(s))}),o._uU(3),o.qZA(),o.TgZ(4,"button",14),o.NdJ("click",function(){const s=o.CHM(e).$implicit,a=o.oxw();return o.KtG(a.leaveGroup(s))}),o.TgZ(5,"mat-icon",15),o._uU(6,"first_page"),o.qZA()()()()}if(2&i){const e=t.$implicit,n=o.oxw();o.xp6(2),o.Tol(n.active(e)),o.xp6(1),o.hij(" ",e.name," ")}}function ut(i,t){1&i&&(o.TgZ(0,"div",16),o._uU(1," No groups "),o.qZA())}function dt(i,t){if(1&i&&(o.TgZ(0,"div",39)(1,"span",40),o._uU(2),o.qZA(),o.TgZ(3,"span",41),o._uU(4),o.qZA()()),2&i){const e=o.oxw().$implicit;o.xp6(2),o.Oqu(e.sender),o.xp6(2),o.Oqu(e.content)}}function gt(i,t){if(1&i&&(o.TgZ(0,"div",42)(1,"span",43),o._uU(2),o.qZA(),o.TgZ(3,"span",44),o._uU(4),o.qZA()()),2&i){const e=o.oxw().$implicit;o.xp6(2),o.Oqu(e.content),o.xp6(2),o.Oqu(e.sender)}}function pt(i,t){if(1&i&&(o.TgZ(0,"div"),o.YNc(1,dt,5,2,"div",37),o.YNc(2,gt,5,2,"div",38),o.qZA()),2&i){const e=t.$implicit,n=o.oxw(2);o.xp6(1),o.Q6J("ngIf",e.sender!==n.chatService.myName),o.xp6(1),o.Q6J("ngIf",e.sender===n.chatService.myName)}}function ft(i,t){if(1&i&&(o.TgZ(0,"div")(1,"div",45),o._uU(2),o.qZA()()),2&i){const e=t.$implicit;o.xp6(2),o.hij(" ",e," ")}}function _t(i,t){if(1&i){const e=o.EpF();o.TgZ(0,"div",46)(1,"button",47),o.NdJ("click",function(){o.CHM(e);const r=o.oxw(2);return o.KtG(r.addUserToGroup())}),o._uU(2," Add member "),o.qZA()()}}function mt(i,t){if(1&i){const e=o.EpF();o.TgZ(0,"div",17)(1,"div",18)(2,"div"),o._uU(3),o.qZA()(),o.TgZ(4,"div",19)(5,"div",20,21),o.YNc(7,pt,3,2,"div",22),o.qZA(),o.TgZ(8,"div",23)(9,"div",24),o._uU(10," Online "),o.qZA(),o.TgZ(11,"div",25),o.YNc(12,ft,3,1,"div",22),o.qZA(),o.YNc(13,_t,3,0,"div",26),o.qZA()(),o.TgZ(14,"div",27)(15,"textarea",28,29),o.NdJ("ngModelChange",function(r){o.CHM(e);const s=o.oxw();return o.KtG(s.content=r)}),o.qZA(),o.TgZ(17,"button",30),o.NdJ("click",function(){o.CHM(e);const r=o.MAs(16),s=o.oxw();return o.KtG(s.sendMessage(r))}),o.TgZ(18,"div",31)(19,"div",32),o.O4$(),o.TgZ(20,"svg",33),o._UZ(21,"path",34)(22,"path",35),o.qZA()()(),o.kcU(),o.TgZ(23,"span",36),o._uU(24,"Send"),o.qZA()()()()}if(2&i){const e=o.oxw();o.xp6(3),o.Oqu(e.chatService.groupName),o.xp6(4),o.Q6J("ngForOf",e.chatService.messages),o.xp6(5),o.Q6J("ngForOf",e.chatService.usersOnline),o.xp6(1),o.Q6J("ngIf",e.chatService.groups.length>0),o.xp6(2),o.Q6J("ngModel",e.content),o.xp6(2),o.ekj("disabled",""===e.content.trim())}}const vt=[{path:"",component:Ye,title:"chat rooms",children:[{path:"",component:(()=>{class i{constructor(e,n,r){this.chatService=e,this.dialog=n,this.sharedService=r,this.content=""}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){if(this.messBox){const e=this.messBox.nativeElement;e.scrollTop=e.scrollHeight}}sendMessage(e){var n=this;return(0,u.Z)(function*(){e.focus(),yield n.chatService.sendMessage(n.content),n.content=""})()}addUserToGroup(){this.dialog.open(ae,{data:{title:"Enter email",data:"hello"}}).afterClosed().subscribe(n=>{void 0===n||""!==n.trim()&&this.chatService.addMemberToGroup(n)})}addGroup(e){""!==e.value.trim()?(this.chatService.addGroupUser(e.value),e.value=""):this.sharedService.showDialog(!1,"Error","Group name is required")}leaveGroup(e){this.chatService.leaveGroup(e)}switchGroup(e){this.chatService.switchGroup(e)}active(e){return e.name===this.chatService.groupName?"bg-blue-600 text-white":!0===e.hasNewMessage?"bg-green-600 text-white":"bg-blue-200 text-blue-900"}}return i.\u0275fac=function(e){return new(e||i)(o.Y36(z),o.Y36(k.uw),o.Y36(G.F))},i.\u0275cmp=o.Xpm({type:i,selectors:[["app-chat"]],viewQuery:function(e,n){if(1&e&&o.Gf(lt,5),2&e){let r;o.iGM(r=o.CRH())&&(n.messBox=r.first)}},decls:13,vars:3,consts:[[1,"w-[300px]","sm:w-[600px]","md:w-[950px]","lg:w-[1200px]","xl:w-[1420px]","h-full","flex"],[1,"w-[80px]","sm:w-[150px]","md:w-[250px]","mt-2"],[1,"h-[47px]","flex","items-center","p-2"],[1,"",3,"click"],[1,"icon-size-add-group-btn","hover:text-blue-500"],["placeholder","Add room","spellcheck","false","type","text",1,"add-field-group-btn"],["inputRef","","inputRoom",""],[1,"p-2","overflow-y-scroll","h-[600px]","min-w-[100px]","sm:min-w-[150px]","md:w-full"],["class","mb-1 cursor-pointer select-none",4,"ngFor","ngForOf"],["class","text-center text-[2em] font-bold mt-[20px] w-full",4,"ngIf"],["class","w-full h-full border-l-2",4,"ngIf"],[1,"mb-1","cursor-pointer","select-none"],[1,"group-item","text-[0.6em]","sm:text-[1em]"],[1,"group-content",3,"click"],[1,"bg-red-100","hover:bg-red-300","hover:text-white","p-2","duration-100",3,"click"],[1,"icon-switch-btn"],[1,"text-center","text-[2em]","font-bold","mt-[20px]","w-full"],[1,"w-full","h-full","border-l-2"],[1,"leading-9","pl-2","text-[2em]","font-bold","border-b-2"],[1,"flex","h-auto","w-full"],[1,"w-4/5","h-[500px]","border-r-2","overflow-y-scroll"],["messBox",""],[4,"ngFor","ngForOf"],[1,"h-[500px]","w-2/5","sm:w-1/5"],[1,"overflow-hidden","bg-blue-200","text-[#2e1065]","leading-8","h-10","m-2","text-center","text-xl"],[1,"h-[380px]","overflow-y-scroll"],["class","h-[100px] flex items-center",4,"ngIf"],[1,"flex","items-center","justify-between","gap-3","m-2"],["name","content","spellcheck","false",1,"w-4/5","border-2","border-[#0ea5e9]","outline-none","focus:bg-yellow-100","h-24","rounded-md","p-2","text-[1.2em]","duration-100",2,"resize","none",3,"ngModel","ngModelChange"],["inputRef",""],[1,"w-1/5","rounded-lg","flex","items-center","justify-center","mr-3","bg-red-300","hover:bg-blue-300","duration-100",3,"click"],[1,"svg-wrapper-1"],[1,"svg-wrapper"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","width","24","height","24"],["fill","none","d","M0 0h24v24H0z"],["fill","currentColor","d","M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"],[1,"font-[2em]","py-2","px-4"],["class","break-words text-[1.2em] m-2 p-2 rounded-2xl bg-[#fee2e2] flex gap-2",4,"ngIf"],["class","break-words text-[1.2em] m-2 p-2 rounded-2xl bg-[#93c5fd] flex gap-2",4,"ngIf"],[1,"break-words","text-[1.2em]","m-2","p-2","rounded-2xl","bg-[#fee2e2]","flex","gap-2"],[1,"w-1/6","font-bold","text-blue-700"],[1,"w-5/6","text-[#4c1d95]"],[1,"break-words","text-[1.2em]","m-2","p-2","rounded-2xl","bg-[#93c5fd]","flex","gap-2"],[1,"w-5/6","text-[#2e1065]"],[1,"text-right","w-1/6","font-bold","text-[#2e1065]"],[1,"overflow-hidden","text-[#2e1065]","leading-8","h-10","m-2","text-center","text-xl","border-b-2","border-b-black"],[1,"h-[100px]","flex","items-center"],[1,"w-full","bg-red-400","mx-5","px-4","py-2","rounded-lg","text-white","hover:bg-blue-300","duration-100",3,"click"]],template:function(e,n){if(1&e){const r=o.EpF();o.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),o.NdJ("click",function(){o.CHM(r);const a=o.MAs(7);return o.KtG(n.addGroup(a))}),o.TgZ(4,"mat-icon",4),o._uU(5,"add_circle"),o.qZA()(),o._UZ(6,"input",5,6),o.qZA(),o.TgZ(9,"ul",7),o.YNc(10,ht,7,3,"li",8),o.qZA()(),o.YNc(11,ut,2,0,"div",9),o.YNc(12,mt,25,7,"div",10),o.qZA()}2&e&&(o.xp6(10),o.Q6J("ngForOf",n.chatService.groups),o.xp6(1),o.Q6J("ngIf",""===n.chatService.groupName),o.xp6(1),o.Q6J("ngIf",""!==n.chatService.groupName))},dependencies:[P.sg,P.O5,j.Hw,T.Fj,T.JJ,T.On],styles:['@charset "UTF-8";.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.group-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 0 1px #0000004d}.icon-size-add-group-btn[_ngcontent-%COMP%]{font-size:40px;height:40px;width:40px}.add-field-group-btn[_ngcontent-%COMP%]{width:100%;border-radius:.375rem;border-width:2px;--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity));padding:.25rem .5rem;font-size:1.4em;outline:2px solid transparent;outline-offset:2px}.add-field-group-btn[_ngcontent-%COMP%]:focus{box-shadow:0 2px 0 1px #60a5fa80;transition:.1s}.group-content[_ngcontent-%COMP%]{width:100%;padding-top:.75rem;padding-bottom:.75rem;text-align:center;font-size:1.3em}.group-content[_ngcontent-%COMP%]:hover{--tw-bg-opacity: 1;background-color:rgb(96 165 250 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity))}.icon-switch-btn[_ngcontent-%COMP%]{text-align:center;font-size:.6em;font-weight:700}@media (min-width: 640px){.icon-switch-btn[_ngcontent-%COMP%]{font-size:1em}}.icon-switch-btn[_ngcontent-%COMP%]{font-size:20px;height:20px;width:20px}']}),i})(),title:"chat"},{path:"search-member",component:at,title:"search"}]}];let bt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=o.oAB({type:i}),i.\u0275inj=o.cJS({imports:[A.Bz.forChild(vt),A.Bz]}),i})(),Ct=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=o.oAB({type:i}),i.\u0275inj=o.cJS({imports:[P.ez,bt,j.Ps,Q.ot,T.u5,K.c,Z.lN,k.Is,Y.TU,x.p0]}),i})()}}]);